--[한국공항] 학자금 신청 기능 개발 요청
--202501 > ... > 202301
-- [1] SCH_LOC_CD='0', SCH_CD, SCH_DEPT_CD 기준가능 YEAR_LONG(9.9), DAY_NIGHT(D/N/S/R - 주간/야간/계절제/원격)
-- [2] 학과코드 최신화 : SCH_CD, SCH_DEPT를 기준으로 체크해보자

--작업결과
--0000331	0208449	한양사이버대학교	글로벌경영학과, 토파스에서 등록한 이 건 외 모두 채움(YEAR_LONG, DAY_NIGHT)


----------------------------------------------
--[8/22]
--TRUNCATE TABLE TBEN753_UNIV_202501;
--TRUNCATE TABLE TBEN753_UNIV_202401;
--TRUNCATE TABLE TBEN753_UNIV_202302;
--TRUNCATE TABLE TBEN753_UNIV_202301;
-------------------------------------------


--CREATE TABLE TBEN753_UNIV_202501
--CREATE TABLE TBEN753_UNIV_202401
--CREATE TABLE TBEN753_UNIV_202302
--CREATE TABLE TBEN753_UNIV_202301

--ALTER TABLE TBEN753
--ADD DAY_NIGHT VARCHAR2(1);
--
--COMMENT ON COLUMN TBEN753.DAY_NIGHT IS '주간/야간/계절제/원경(D/N/S/R)';
--COMMENT ON COLUMN TBEN753.YEAR_LONG IS '수영년한(9.9)';

--ALTER TABLE TBEN753
--ADD SCH_CAMPUS VARCHAR2(50);
--COMMENT ON COLUMN TBEN753.SCH_CAMPUS IS '캠퍼스구분(본교/캠퍼스)';

ALTER TABLE TBEN751
ADD REVERSE_YN VARCHAR2(1);
COMMENT ON COLUMN TBEN751.REVERSE_YN IS '역학기신청 여부(Y/N)';




ALTER TABLE TBEN753_UNIV_202501 ADD SCH_CAMPUS VARCHAR2(50);
ALTER TABLE TBEN753_UNIV_202401 ADD SCH_CAMPUS VARCHAR2(50);
ALTER TABLE TBEN753_UNIV_202302 ADD SCH_CAMPUS VARCHAR2(50);
ALTER TABLE TBEN753_UNIV_202301 ADD SCH_CAMPUS VARCHAR2(50);





--UPDATE TBEN753_UNIV_202501 SET DAY_NIGHT='D' WHERE DAY_NIGHT='주간';
--UPDATE TBEN753_UNIV_202501 SET DAY_NIGHT='N' WHERE DAY_NIGHT='야간';
--UPDATE TBEN753_UNIV_202501 SET DAY_NIGHT='S' WHERE DAY_NIGHT='계절제';
--UPDATE TBEN753_UNIV_202501 SET DAY_NIGHT='R' WHERE DAY_NIGHT='원격';
--
--UPDATE TBEN753_UNIV_202401 SET DAY_NIGHT='D' WHERE DAY_NIGHT='주간';
--UPDATE TBEN753_UNIV_202401 SET DAY_NIGHT='N' WHERE DAY_NIGHT='야간';
--UPDATE TBEN753_UNIV_202401 SET DAY_NIGHT='S' WHERE DAY_NIGHT='계절제';
--UPDATE TBEN753_UNIV_202401 SET DAY_NIGHT='R' WHERE DAY_NIGHT='원격';
--
--UPDATE TBEN753_UNIV_202302 SET DAY_NIGHT='D' WHERE DAY_NIGHT='주간';
--UPDATE TBEN753_UNIV_202302 SET DAY_NIGHT='N' WHERE DAY_NIGHT='야간';
--UPDATE TBEN753_UNIV_202302 SET DAY_NIGHT='S' WHERE DAY_NIGHT='계절제';
--UPDATE TBEN753_UNIV_202302 SET DAY_NIGHT='R' WHERE DAY_NIGHT='원격';

--CREATE INDEX IDX_UNIV_SCH_CD_DEPT_CD ON TBEN753_UNIV_202501 (SCH_CD, SCH_DEPT_CD);
--CREATE INDEX IDX_TBEN753_UPDATE ON TBEN753 (ENTER_CD, SCH_LOC_CD, SCH_CD, SCH_DEPT_CD);

--UPDATE TBEN753 A
--SET
--    A.YEAR_LONG = (SELECT B.YEAR_LONG FROM TBEN753_UNIV_202501 B WHERE A.SCH_CD = B.SCH_CD AND A.SCH_DEPT_CD = B.SCH_DEPT_CD),
--    A.DAY_NIGHT = (SELECT B.DAY_NIGHT FROM TBEN753_UNIV_202501 B WHERE A.SCH_CD = B.SCH_CD AND A.SCH_DEPT_CD = B.SCH_DEPT_CD)
--WHERE
--    A.ENTER_CD = 'KS' AND A.SCH_LOC_CD = '0'
--    AND EXISTS (
--        SELECT 1
--        FROM TBEN753_UNIV_202501 B
--        WHERE A.SCH_CD = B.SCH_CD
--          AND A.SCH_DEPT_CD = B.SCH_DEPT_CD
--    );
--
--
--UPDATE TBEN753 A
--SET
--    A.YEAR_LONG = (SELECT B.YEAR_LONG FROM TBEN753_UNIV_202301 B WHERE A.SCH_CD = B.SCH_CD AND A.SCH_DEPT_CD = B.SCH_DEPT_CD)
--WHERE
--    A.ENTER_CD = 'KS' AND A.SCH_LOC_CD = '0' AND (A.YEAR_LONG IS NULL OR A.YEAR_LONG=0)
--    AND EXISTS (
--        SELECT 1
--        FROM TBEN753_UNIV_202301 B
--        WHERE A.SCH_CD = B.SCH_CD
--          AND A.SCH_DEPT_CD = B.SCH_DEPT_CD
--    );
--
--UPDATE TBEN753 A
--SET
--    A.DAY_NIGHT = (SELECT B.DAY_NIGHT FROM TBEN753_UNIV_202301 B WHERE A.SCH_CD = B.SCH_CD AND A.SCH_DEPT_CD = B.SCH_DEPT_CD)
--WHERE
--    A.ENTER_CD = 'KS' AND A.SCH_LOC_CD = '0' AND A.DAY_NIGHT IS NULL
--    AND EXISTS (
--        SELECT 1
--        FROM TBEN753_UNIV_202301 B
--        WHERE A.SCH_CD = B.SCH_CD
--          AND A.SCH_DEPT_CD = B.SCH_DEPT_CD
--    );


-------------------------------------------------------------------------------------
/*    
TBEN753_UNIV_202501
TBEN753_UNIV_202401
TBEN753_UNIV_202302
TBEN753_UNIV_202301
*/

SELECT * FROM TBEN753;
SELECT * FROM TBEN753_UNIV_202501; --69516
SELECT * FROM TBEN753_UNIV_202401; --69516
SELECT * FROM TBEN753_UNIV_202302; --69516
SELECT * FROM TBEN753_UNIV_202301; --52174

SELECT DISTINCT DAY_NIGHT FROM TBEN753_UNIV_202501;
SELECT DISTINCT DAY_NIGHT FROM TBEN753_UNIV_202401;
SELECT DISTINCT DAY_NIGHT FROM TBEN753_UNIV_202302;
SELECT DISTINCT DAY_NIGHT FROM TBEN753_UNIV_202301;

SELECT DISTINCT YEAR_LONG FROM TBEN753_UNIV_202501;
SELECT DISTINCT YEAR_LONG FROM TBEN753_UNIV_202401;
SELECT DISTINCT YEAR_LONG FROM TBEN753_UNIV_202302;
SELECT DISTINCT YEAR_LONG FROM TBEN753_UNIV_202301;
-------------------------------------------------------------------------------------
SELECT B.YEAR_LONG,B.DAY_NIGHT,A.*
FROM TBEN753 A
LEFT OUTER JOIN TBEN753_UNIV_202501 B
    ON A.SCH_CD = B.SCH_CD AND A.SCH_DEPT_CD = B.SCH_DEPT_CD
WHERE 1=1
    AND A.ENTER_CD='KS'
    AND A.SCH_LOC_CD='0'
;
    
    
    
    

-------------------------------------------------------------------------------------
SELECT * FROM TBEN753;

SELECT COUNT(*) FROM TBEN753_UNIV_202301; --69516
SELECT COUNT(*) FROM TBEN753_UNIV_202302; --52174

SELECT * 
FROM TBEN753
WHERE ENTER_CD='KS'
    AND SCH_CD||SCH_DEPT_CD NOT IN (SELECT SCH_CD||SCH_DEPT_CD FROM TBEN753_UNIV_202501)
    AND SCH_CD||SCH_DEPT_CD NOT IN (SELECT SCH_CD||SCH_DEPT_CD FROM TBEN753_UNIV_202401)
    AND SCH_CD||SCH_DEPT_CD NOT IN (SELECT SCH_CD||SCH_DEPT_CD FROM TBEN753_UNIV_202302)
    AND SCH_CD||SCH_DEPT_CD NOT IN (SELECT SCH_CD||SCH_DEPT_CD FROM TBEN753_UNIV_202301)
    ;
    
SELECT SCH_NAME, SCH_DEPT,COUNT(*)
FROM TBEN753_UNIV_202501
HAVING COUNT(*) >1
GROUP BY SCH_NAME, SCH_DEPT
order by 3 desc;


--KS	30	0000501	0238798	신구대학교	자율전공학과	Y	24/02/22	ADMIN	56	자연과학계열	0	2
SELECT * 
FROM TBEN753
WHERE ENTER_CD='KS' AND SCH_LOC_CD='0'
    AND SCH_CD||SCH_DEPT NOT IN (SELECT SCH_CD||SCH_DEPT FROM TBEN753_UNIV_202501)
    AND SCH_CD||SCH_DEPT NOT IN (SELECT SCH_CD||SCH_DEPT FROM TBEN753_UNIV_202401)
    AND SCH_CD||SCH_DEPT NOT IN (SELECT SCH_CD||SCH_DEPT FROM TBEN753_UNIV_202302)
    AND SCH_CD||SCH_DEPT NOT IN (SELECT SCH_CD||SCH_DEPT FROM TBEN753_UNIV_202301)
    ;
    
SELECT * FROM TBEN753_UNIV_202501 WHERE SCH_CD='0000501' AND SCH_DEPT_CD='0238798';
SELECT * FROM TBEN753_UNIV_202401 WHERE SCH_CD='0000501' AND SCH_DEPT_CD='0238798';
SELECT * FROM TBEN753_UNIV_202302 WHERE SCH_CD='0000501' AND SCH_DEPT_CD='0238798';
SELECT * FROM TBEN753_UNIV_202301 WHERE SCH_CD='0000501' AND SCH_DEPT_CD='0238798';

SELECT * FROM TBEN753_UNIV_202501 WHERE SCH_CD='0000501' AND SCH_DEPT=' 자율전공학과';
SELECT * FROM TBEN753_UNIV_202501 WHERE                      SCH_DEPT=' 자율전공학과';
SELECT * FROM TBEN753_UNIV_202401 WHERE SCH_CD='0000501' AND SCH_DEPT=' 자율전공학과';
SELECT * FROM TBEN753_UNIV_202302 WHERE SCH_CD='0000501' AND SCH_DEPT=' 자율전공학과';
SELECT * FROM TBEN753_UNIV_202301 WHERE SCH_CD='0000501' AND SCH_DEPT=' 자율전공학과';


--자율전공학과    
-- 자율전공학과
 
UPDATE TBEN753_UNIV_202501 SET SCH_DEPT='자율전공학과' WHERE SCH_DEPT=' 자율전공학과';
UPDATE TBEN753_UNIV_202401 SET SCH_DEPT='자율전공학과' WHERE SCH_DEPT=' 자율전공학과';
UPDATE TBEN753_UNIV_202302 SET SCH_DEPT='자율전공학과' WHERE SCH_DEPT=' 자율전공학과';
UPDATE TBEN753_UNIV_202301 SET SCH_DEPT='자율전공학과' WHERE SCH_DEPT=' 자율전공학과';

-----------------------------------------------------------------------------------------------
SELECT SCH_CD,SCH_DEPT,COUNT(*)
FROM TBEN753
WHERE 1=1
    AND ENTER_CD='KS'
    AND SCH_LOC_CD='0'
    AND USE_YN='Y'
HAVING COUNT(*) >1
GROUP BY SCH_CD,SCH_DEPT
;

SELECT * FROM TBEN753 WHERE ENTER_CD='KS' AND USE_YN='Y' AND SCH_CD='0002640' AND SCH_DEPT='소방안전관리과';

SELECT SCH_CD,SCH_DEPT_CD,COUNT(*)
FROM TBEN753
WHERE 1=1
    AND ENTER_CD='KS'
    AND SCH_LOC_CD='0'
    AND USE_YN='Y'
HAVING COUNT(*) >1
GROUP BY SCH_CD,SCH_DEPT_CD
;
--------------------------------------------------------------------------

SELECT * FROM TBEN753 WHERE ENTER_CD='KS' AND SCH_LOC_CD = '0' AND (YEAR_LONG IS NULL OR YEAR_LONG=0);
SELECT * FROM TBEN753 WHERE ENTER_CD='KS' AND SCH_LOC_CD = '0' AND DAY_NIGHT IS NULL;
----------------------------------------------------------------------------------------------------------------------
--[2]학과코드 최신화
--다음 >1 인것들 먼저 CLEANSING 필요, 여기서 일단 중단.
SELECT SCH_NAME,SCH_DEPT,COUNT(*) FROM TBEN753
WHERE ENTER_CD='KS' AND SCH_LOC_CD='0' AND USE_YN='Y'
HAVING COUNT(*)>1
GROUP BY SCH_NAME,SCH_DEPT
ORDER BY COUNT(*) DESC;


------------------------------------------------------------------
--[sr1] 대학 콤포 변경=> 수업년한 표기
-- 대학별 수업 년한 unique? 학과별?
select distinct sch_cd, year_long
from tben753
where enter_cd='KS' and sch_loc_cd='0' and use_yn='Y';

SELECT COUNT(*) FROM TBEN753
WHERE ENTER_CD='KS' AND USE_YN='Y' AND SCH_LOC_CD='0';

--13288

SELECT COUNT(DISTINCT SCH_CD||SCH_DEPT_CD) FROM TBEN753
WHERE ENTER_CD='KS' AND USE_YN='Y' AND SCH_LOC_CD='0';
--------------------------------------------------------------------
--대학 2개 뜸, 건양 대학교 : 본교/제2캠퍼스, SCH_CAMPUS 컬럼 추가 필요+값설정(필수)
